# Constract App Service Architecture

## 1. 개요 (Overview)
**Constract App**은 전세 계약서와 등기부등본 이미지를 OCR 및 LLM으로 분석하여, 전세 사기 위험 요소(깡통전세, 특약 누락, 권리 관계 등)를 진단하고 시각화해주는 웹 애플리케이션입니다.

> **Feature Highlight**: 개인 민감 정보를 서버에 저장하지 않고 클라이언트 브라우저 내에서 분석 프로세스를 처리하거나 일회성 AI 호출만 수행하는 **Privacy-First** 구조를 지향합니다.

## 2. 주요 기술 스택 (Tech Stack)

### Core
- **Framework**: React 18, Vite
- **Language**: JavaScript (ES6+)
- **Routing**: React Router DOM v6
- **State Management**: Context API (`ChatContext`), `sessionStorage` (분석 결과 유지)

### AI & Analysis
- **OCR**: Tesseract.js (클라이언트 OCR)
- **LLM**: OpenAI GPT-4o API (계약 분석 및 시뮬레이션)
- **Logic**: 정규식 기반 패턴 매칭 (`fraudPatterns.json`)

### Visualization (Labs)
실험실(`DevTools`) 기능 강화를 위해 다양한 시각화 라이브러리를 복합적으로 사용했습니다.
- **Network**: `react-force-graph-2d` (물리 엔진), `react-cytoscapejs` (구조 분석)
- **Flow**: `d3.js` (Custom Sankey), `recharts` (Simple Sankey)
- **Chart**: `recharts` (Radar Risk Profile)

## 3. 서비스 아키텍처 (Architecture Diagram)

```mermaid
graph TD
    User[사용자] -->|이미지 업로드| UploadPage
    User -->|데모 실행| ResultPage
    
    subgraph Client [Browser Client]
        UploadPage -->|OCR 처리| Tesseract[Tesseract.js]
        
        Tesseract -->|Text| AnalysisService
        AnalysisService -->|API Call| OpenAI[OpenAI GPT-4o]
        
        OpenAI -->|JSON Result| SessionStorage
        SessionStorage --> ResultPage
        
        ResultPage --> Tab1[종합 분석 탭]
        ResultPage --> Tab2[실험실 탭]
        
        subgraph Tab1 [일반 사용자용]
            ScoreHero[안전 점수]
            RiskPanel[리스크 요약]
            SmartChecklist[특약 체크리스트]
        end
        
        subgraph Tab2 [개발자/전문가용]
            DevTools[DevTools Container]
            DevTools --> ForceGraph[관계도 (Force)]
            DevTools --> CytoGraph[관계도 (Cytoscape)]
            DevTools --> D3Flow[자금흐름 (D3)]
            DevTools --> RadarChart[위험도 레이더]
        end
    end
```

## 4. 디렉토리 구조 (Directory Structure)

```
src/
├── pages/                  # 라우트 페이지
│   ├── UploadPage.jsx      # 메인: 업로드 및 데모 시작
│   └── ResultPage.jsx      # 결과: 탭 컨테이너 및 분석 결과 표시
├── components/
│   ├── dev/                # 실험실(Labs) 전용 컴포넌트
│   │   ├── DevTools.jsx    # 실험실 탭 컨테이너
│   │   ├── NetworkGraph.jsx    # Force Graph
│   │   ├── CytoscapeGraph.jsx  # Cytoscape Graph
│   │   ├── D3Sankey.jsx        # D3 Custom Layout Sankey
│   │   └── RiskRadarChart.jsx  # Recharts Radar
│   ├── RiskSummaryPanel.jsx # 일반용 리스크 패널
│   └── SmartChecklist.jsx   # 체크리스트 컴포넌트
├── services/               # 비즈니스 로직
│   ├── analysisService.js  # AI 분석 요청 핸들러
│   └── textExtraction.js    # OCR 처리 로직
└── data/
    └── fraudPatterns.json  # 전세 사기 패턴 DB
```

## 5. 데이터 흐름 및 상태 관리

### 5.1. 분석 결과 데이터 (`result` Object)
모든 컴포넌트는 `result` 객체를 Props로 공유하며 렌더링합니다.
- `summary_panel`: 전세가율, 위험 요소 요약
- `entities`: [임대인, 임차인, 부동산, 보증금] 노드 리스트
- `relations`: [소유, 계약, 근저당] 등 엣지 리스트
- `issues`: 발견된 위험 사항 리스트

### 5.2. 실험실(DevTools) 구현 디테일
- **D3 Sankey**: `d3-sankey` 라이브러리의 불안정성을 해결하기 위해 **Manual Layout Calculation** 방식을 도입했습니다. SVG 좌표를 직접 계산하여 데이터 무결성과 렌더링 안정성을 확보했습니다.
- **Cytoscape**: 복잡한 권리 관계를 전문적으로 분석하기 위한 **cose** 레이아웃을 적용했습니다.

---
*Document generated by Constract AI Assistant*
